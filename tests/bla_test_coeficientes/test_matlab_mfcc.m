close all;
clear all;

[audio fs] = audioread('testaudio.wav');
BLA_LARGOVENTANA = 400;
BLA_LARGOBLOQUE = 160;

NBLOQUE = 0;

n = 1:BLA_LARGOVENTANA;
%Cuantización como hace la biblioteca
COEF_CUANTIZ = 512-1;%512-1;
bloque = round(audio*COEF_CUANTIZ);
audiowrite('testaudio_10bits.wav',bloque/COEF_CUANTIZ,fs);
[bloque fs] = audioread('testaudio_10bits.wav');
bloque = bloque(n+BLA_LARGOBLOQUE*NBLOQUE);
bloque = bloque *2^15;

%bloque = bloque * 2^15

%Remover offset DC
offset = sum(bloque)/BLA_LARGOVENTANA;
bloque = bloque - offset;

a = [31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 95.706879 31.581636 95.706879 31.581636 31.581636 31.581636 95.706879 95.706879 95.706879 31.581636 95.706879 31.581636 159.832123 95.706879 95.706879 95.706879 159.832123 95.706879 159.832123 95.706879 159.832123 95.706879 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 223.957367 159.832123 223.957367 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 223.957367 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 159.832123 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -96.668854 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -96.668854 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -96.668854 -96.668854 -32.543610 -32.543610 -96.668854 -32.543610 -96.668854 -32.543610 -96.668854 -32.543610 -96.668854 -96.668854 -32.543610 -96.668854 -32.543610 -32.543610 -96.668854 -32.543610 -32.543610 -96.668854 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 31.581636 -32.543610 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 95.706879 31.581636 95.706879 31.581636 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 159.832123 95.706879 159.832123 95.706879 159.832123 159.832123 159.832123 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 95.706879 31.581636 95.706879 31.581636 95.706879 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 -32.543610 -32.543610 31.581636 -32.543610 31.581636 -32.543610 31.581636 -32.543610 -32.543610 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 31.581636 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 31.581636 31.581636 31.581636 -32.543610 31.581636 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 31.581636 -32.543610 -32.543610 31.581636 31.581636 -32.543610 31.581636 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 31.581636 -96.668854 -32.543610 -32.543610 -32.543610 -96.668854 -96.668854 -32.543610 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -96.668854 -96.668854 -96.668854 -96.668854 -96.668854 -160.794098 -32.543610 -160.794098 -160.794098 -160.794098 -96.668854 -160.794098 -160.794098 -96.668854 -96.668854 -160.794098 -160.794098 -96.668854 -160.794098 -96.668854 -96.668854 -160.794098 -96.668854 -160.794098 -96.668854 -96.668854 -160.794098 -32.543610 -96.668854 -160.794098 -32.543610 -32.543610 -96.668854 -160.794098 -32.543610 -32.543610 -96.668854 -160.794098 -96.668854 31.581636 -96.668854 -160.794098 -96.668854 31.581636 -96.668854 -96.668854 -96.668854 -32.543610 -32.543610 -96.668854 -96.668854 -32.543610 31.581636 -96.668854 -96.668854 -96.668854 31.581636 -96.668854 -32.543610 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 31.581636 -32.543610 31.581636 -32.543610 -32.543610 -32.543610 -32.543610 -32.543610 -96.668854 -32.543610 -96.668854 -32.543610 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -96.668854 -32.543610 -32.543610 -32.543610 -96.668854 -32.543610 -32.543610 -96.668854 -96.668854 -32.543610 -32.543610 -96.668854 -32.543610 -96.668854 -96.668854 -96.668854 -96.668854 -160.794098 -32.543610 -32.543610 -32.543610 -96.668854 -96.668854 -96.668854 -32.543610];
b = [0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 65.072693 -61.254036 65.072693 -61.254036 0.947449 0.947449 65.072693 2.871206 2.871206 -61.254036 65.072693 -61.254036 129.197937 -59.330280 2.871206 2.871206 66.996452 -59.330280 66.996452 -59.330280 66.996452 -59.330280 66.996452 4.794964 4.794964 4.794964 4.794964 4.794964 68.920204 -57.406525 68.920204 -57.406525 4.794964 4.794964 4.794964 4.794964 4.794964 68.920204 -57.406525 4.794964 4.794964 4.794964 4.794964 4.794964 4.794964 4.794964 4.794964 4.794964 4.794964 4.794964 -59.330280 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 -61.254036 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 -63.177795 63.148937 -63.177795 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -65.101555 61.225178 -65.101555 61.225178 -0.976308 -0.976308 -0.976308 -0.976308 -65.101555 61.225178 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -65.101555 61.225178 -65.101555 61.225178 -0.976308 -0.976308 -65.101555 61.225178 -0.976308 -0.976308 -65.101555 -2.900066 61.225178 -0.976308 -65.101555 61.225178 -65.101555 61.225178 -65.101555 61.225178 -65.101555 -2.900066 61.225178 -65.101555 61.225178 -0.976308 -65.101555 61.225178 -0.976308 -65.101555 61.225178 -65.101555 61.225178 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 63.148937 -63.177795 63.148937 0.947449 0.947449 0.947449 0.947449 0.947449 65.072693 -61.254036 65.072693 -61.254036 65.072693 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 66.996452 -59.330280 66.996452 -59.330280 66.996452 4.794964 4.794964 -59.330280 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 2.871206 -61.254036 65.072693 -61.254036 65.072693 -61.254036 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 -63.177795 -0.976308 63.148937 -63.177795 63.148937 -63.177795 63.148937 -63.177795 -0.976308 63.148937 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 0.947449 -63.177795 63.148937 -63.177795 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 63.148937 -63.177795 -0.976308 -0.976308 -0.976308 -0.976308 63.148937 0.947449 0.947449 -63.177795 63.148937 -63.177795 63.148937 -63.177795 -0.976308 -0.976308 63.148937 -63.177795 -0.976308 63.148937 0.947449 -63.177795 63.148937 -63.177795 63.148937 -63.177795 -0.976308 -0.976308 63.148937 -127.303040 61.225178 -0.976308 -0.976308 -65.101555 -2.900066 61.225178 -0.976308 -65.101555 61.225178 -0.976308 -0.976308 -65.101555 -2.900066 -2.900066 -2.900066 -2.900066 -67.025307 123.426666 -129.226791 -4.823823 -4.823823 59.301422 -67.025307 -4.823823 59.301422 -2.900066 -67.025307 -4.823823 59.301422 -67.025307 59.301422 -2.900066 -67.025307 59.301422 -67.025307 59.301422 -2.900066 -67.025307 123.426666 -65.101555 -67.025307 123.426666 -0.976308 -65.101555 -67.025307 123.426666 -0.976308 -65.101555 -67.025307 59.301422 125.350426 -127.303040 -67.025307 59.301422 125.350426 -127.303040 -2.900066 -2.900066 61.225178 -0.976308 -65.101555 -2.900066 61.225178 63.148937 -127.303040 -2.900066 -2.900066 125.350426 -127.303040 61.225178 -0.976308 63.148937 -63.177795 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 -0.976308 63.148937 -63.177795 -0.976308 -0.976308 63.148937 -63.177795 63.148937 -63.177795 -0.976308 -0.976308 -0.976308 -0.976308 -65.101555 61.225178 -65.101555 61.225178 -0.976308 -65.101555 61.225178 -0.976308 -0.976308 -65.101555 61.225178 -0.976308 -0.976308 -65.101555 61.225178 -0.976308 -65.101555 -2.900066 61.225178 -0.976308 -65.101555 61.225178 -65.101555 -2.900066 -2.900066 -2.900066 -67.025307 123.426666 -0.976308 -0.976308 -65.101555 -2.900066 -2.900066 61.225178];
c = [0.075796 0.075850 0.076012 0.076282 0.076660 0.077146 0.077740 0.078441 0.079250 5.505938 -5.248964 5.653776 -5.401910 0.084896 0.086345 6.037010 0.271398 0.276741 -6.024699 6.535674 -6.286260 13.555973 -6.367917 0.315382 0.322904 7.717246 -7.002165 8.103620 -7.356700 8.517838 -7.735715 8.959490 0.657766 0.674776 0.692261 0.710216 0.728637 10.744445 -9.181035 11.306890 -9.660278 0.827569 0.848686 0.870235 0.892210 0.914606 13.473926 -11.501001 0.984263 1.008285 1.032700 1.057501 1.082681 1.108235 1.134157 1.160439 1.187075 1.214059 1.241385 -15.702463 0.776657 0.793607 0.810746 0.828067 0.845567 0.863243 0.881089 0.899100 0.917273 -19.960079 0.314832 0.320980 0.327175 0.333416 0.339701 0.346028 0.352397 0.358805 0.365251 -24.787949 25.210995 -25.659294 -0.403304 -0.410117 -0.416958 -0.423828 -0.430722 -0.437641 -0.444582 -0.451543 -0.458524 -0.465521 -0.472533 -0.479559 -0.486597 -0.493645 -33.387436 31.842350 -34.329681 32.728977 -0.528974 -0.536046 -0.543115 -0.550181 -37.157562 35.387325 -0.571336 -0.578368 -0.585388 -0.592393 -0.599382 -0.606353 -0.613304 -41.358047 39.328583 -42.277523 40.190094 -0.647706 -0.654504 -44.094379 41.891060 -0.674701 -0.681362 -45.875778 -2.063174 43.967247 -0.707609 -47.614651 45.181328 -48.465977 45.975853 -49.304104 46.757572 -50.128201 -2.251160 47.904446 -51.336239 48.650780 -0.781653 -52.508171 49.741058 -0.798846 -53.641388 50.794128 -54.374096 51.474331 -0.826134 -0.831375 -0.836540 -0.841629 -0.846639 -0.851570 -0.856421 55.702976 -56.031693 56.303795 0.849132 0.853433 0.857648 0.861777 0.865820 59.737888 -56.482246 60.262787 -56.964668 60.762760 2.691650 2.701978 2.712021 2.721775 2.731239 2.740410 2.749287 2.757865 2.766145 2.774123 64.910194 -57.635029 65.246933 -57.920498 65.554840 4.702025 4.711739 -58.414181 2.832058 2.836925 2.841473 2.845701 2.849608 2.853193 2.856455 2.859392 2.862005 2.864294 2.866256 2.867892 2.869201 2.870183 -61.246174 65.071762 -61.253162 65.064339 -61.232204 0.946787 0.946355 0.945815 0.945168 0.944413 0.943551 -62.853199 -0.970183 62.673912 -62.616589 62.494995 -62.423473 62.287914 -62.202290 -0.959363 61.924946 0.927062 0.924936 0.922708 0.920377 0.917946 0.915413 0.912781 0.910048 0.907218 0.904289 0.901262 -59.889729 59.647827 -59.454113 -0.915253 -0.911645 -0.907941 -0.904144 -0.900252 -0.896268 -0.892193 -0.888027 -0.883772 -0.879428 -0.874997 -0.870480 56.006104 -55.728428 -0.856421 -0.851570 -0.846639 -0.841629 54.108540 0.806800 0.801714 -53.115974 52.743229 -52.414078 52.032497 -51.694035 -0.793180 -0.787449 50.558399 -50.202362 -0.769874 49.409649 0.735452 -48.646900 48.226749 -47.847160 47.420471 -47.033802 -0.720470 -0.714062 45.769073 -91.419319 43.557007 -0.687985 -0.681362 -44.989960 -1.984263 41.468849 -0.654504 -43.189926 40.190094 -0.634023 -0.627141 -41.358044 -1.821783 -1.801134 -1.780428 -1.759668 -40.187923 73.118370 -75.623573 -2.788105 -2.753260 33.418251 -37.285847 -2.648540 32.130157 -1.550280 -35.344120 -2.508802 30.412832 -33.889606 29.556139 -1.424502 -32.440250 28.275944 -31.478466 27.426956 -1.320605 -30.044842 54.452694 -28.261400 -28.624939 51.847702 -0.403304 -26.440619 -26.758560 48.426735 -0.376377 -24.654402 -24.929602 21.658131 44.943474 -44.799080 -23.145321 20.090336 41.653282 -41.482632 -0.926494 -0.908137 18.788208 -0.293532 -19.172340 -0.836390 17.288214 17.454504 -34.435287 -0.767537 -0.750808 31.738070 -31.516041 14.817231 -0.230927 14.595282 -14.265261 -0.215319 -0.210269 -0.205298 -0.200407 -0.195597 -0.190869 12.045221 -11.755636 -0.177190 -0.172802 10.898961 -10.631457 10.360070 -10.104033 -0.152203 -0.148359 -0.144608 -0.140952 -9.161473 8.398774 -8.706081 7.982781 -0.124126 -8.072315 7.405548 -0.115224 -0.112460 -7.321519 6.725166 -0.104787 -0.102438 -6.681115 6.149244 -0.096026 -6.274810 -0.274125 5.680065 -0.088975 -5.833444 5.399365 -5.656282 -0.248512 -0.245381 -0.242577 -5.549151 10.127373 -0.079496 -0.078995 -5.241536 -0.232667 -0.232171 4.898014];

%Filtro Preenfasis
bloquePreenf = filter([1 -0.97],[1],bloque); % El primer coeficiente queda igual
bloquePreenf(1) = bloquePreenf(1) * (1-0.97);

%Ventaneo Hamming
arg = 2.0*pi*(n-1)/(BLA_LARGOVENTANA-1);
coefHamming = 0.54-0.46*cos(arg);
bloqueHamming = bloquePreenf .* coefHamming';

%MFCC

%Energía
energia = log(sum(bloque.^2));

%FFT con zero padding
bloqueFFT = fft(bloqueHamming, 512);
bloqueFFTMagSquared = abs(bloqueFFT).^2;

d = [5849.327637 25458.132813 76914.078125 111399.476563 44074.781250 64275.437500 82282.718750 76713.289063 19499.412109 18724.533203 28811.748047 21685.980469 12234.181641 7672.967773 5157.831543 9929.896484 25444.126953 34908.421875 24543.212891 16058.685547 13265.052734 13791.282227 23242.427734 35547.445313 34366.843750 21242.082031 8779.461914 536.769104 8805.181641 22044.099609 5346.623047 2613.768799 7578.348633 22094.435547 61135.199219 62153.953125 20813.947266 3778.851807 1618.110107 3716.279297 33580.515625 33621.304688 22834.056641 22676.539063 22045.822266 7931.308105 1834.565674 8780.882813 7593.993652 60578.835938 51514.539063 2249.523193 23212.343750 18532.068359 26702.951172 1359.284546 53104.101563 69375.218750 6320.475586 25262.876953 17940.388672 6958.704590 12118.503906 21912.984375 84164.414063 136898.437500 48923.386719 90211.546875 68484.875000 9792.974609 10695.407227 6308.421875 4046.633545 1223.895752 13781.577148 55836.195313 2836.461426 94100.601563 168545.421875 149532.390625 118346.015625 97922.367188 115492.835938 67378.507813 21419.501953 27810.640625 2919.012695 11309.536133 14671.958984 36508.695313 21647.455078 36906.789063 13419.036133 7873.693359 80657.289063 151094.750000 46304.628906 9274.130859 14705.871094 86214.757813 49508.792969 128010.906250 374726.906250 658969.250000 226252.203125 9420.487305 65858.929688 21016.488281 40117.175781 21452.455078 122338.835938 175582.875000 603.813904 94123.054688 17972.822266 85474.937500 147240.796875 125861.132813 204741.781250 147428.812500 253639.843750 375641.843750 52390.347656 62547.847656 321327.562500 1206936.375000 1200133.250000 545591.125000 1152611.375000 542107.812500 11098.083984 76104.718750 331292.343750 518389.125000 338549.000000 632740.625000 644471.312500 31626.308594 299781.843750 291669.406250 395514.687500 317997.968750 49478.007813 108618.539063 262683.406250 77797.507813 178822.687500 32264.675781 68547.164063 400549.906250 296743.937500 127291.921875 213219.359375 148898.578125 129719.570313 93724.117188 193683.187500 414775.843750 477535.406250 269713.406250 24167.933594 254587.187500 429723.812500 175402.687500 43555.925781 295099.937500 419866.781250 171620.546875 13256.481445 34090.058594 45792.296875 159009.812500 187908.609375 82659.398438 1183783.000000 1200582.250000 263647.937500 472198.906250 345020.750000 50723.382813 73646.375000 114014.531250 218131.421875 92692.265625 196271.406250 68802.273438 509786.843750 802672.687500 297445.250000 425237.687500 494401.093750 146065.218750 249698.515625 203364.468750 67487.421875 349953.031250 288409.750000 323398.968750 1174136.375000 519823.906250 185266.734375 1432224.125000 1771163.625000 981884.687500 1115758.750000 1217747.500000 433493.968750 4967.135254 50870.238281 62574.058594 385684.281250 707374.625000 120243.859375 21582.177734 95308.015625 647047.625000 572210.812500 150441.125000 942414.000000 1188627.125000 1259594.500000 1761131.750000 1174081.500000 351720.375000 426930.937500 610338.187500 261816.296875 365058.687500 405196.375000 438541.843750 23261.820313 207380.046875 97458.460938 744527.937500 993269.062500 169935.703125 104202.585938 493211.781250 661130.000000 214712.453125 441222.968750 692097.687500 231999.593750 124213.257813 667296.062500 532844.562500 2341619.500000 5357027.000000 2393717.000000 114885.093750 342491.250000 452606.156250 538585.187500 828518.687500 2365263.750000 1778801.625000];

BLA_NUMCHANS = 26;
iNumChans = 1:BLA_NUMCHANS; %NumChannels
%fBordeMel = 1127.0*log(1.0+8000/700.0);
%fCentralMel = iNumChans/(BLA_NUMCHANS+1)*fBordeMel;
%fCentralHz = 700*(exp(fCentralMel/1127)-1);
%fCentralFFT = floor(fCentralHz/8000 * 256);
melFloor = 1;

filtros = [0.000000,-1
0.532053,0
0.083690,0
0.653340,1
0.239609,1
0.841262,2
0.457196,2
0.086422,2
0.728051,3
0.381280,3
0.045381,3
0.719694,4
0.403615,4
0.096594,4
0.798127,5
0.507748,5
0.225033,5
0.949586,6
0.681043,6
0.419067,6
0.163344,6
0.913582,7
0.669510,7
0.430874,7
0.197439,7
0.968980,8
0.745291,8
0.526177,8
0.311455,8
0.100951,8
0.894504,9
0.691959,9
0.493172,9
0.298007,9
0.106333,9
0.918027,10
0.732974,10
0.551064,10
0.372190,10
0.196254,10
0.023160,10
0.852818,11
0.685141,11
0.520049,11
0.357461,11
0.197305,11
0.039506,11
0.883999,12
0.730716,12
0.579595,12
0.430576,12
0.283601,12
0.138615,12
0.995566,13
0.854400,13
0.715071,13
0.577529,13
0.441732,13
0.307633,13
0.175193,13
0.044370,13
0.915125,14
0.787420,14
0.661220,14
0.536488,14
0.413192,14
0.291299,14
0.170777,14
0.051596,14
0.933725,15
0.817138,15
0.701805,15
0.587701,15
0.474799,15
0.363075,15
0.252503,15
0.143061,15
0.034725,15
0.927474,16
0.821286,16
0.716140,16
0.612015,16
0.508894,16
0.406755,16
0.305580,16
0.205353,16
0.106053,16
0.007666,16
0.910174,17
0.813561,17
0.717812,17
0.622911,17
0.528842,17
0.435593,17
0.343147,17
0.251494,17
0.160617,17
0.070505,17
0.981144,18
0.892523,18
0.804628,18
0.717448,18
0.630972,18
0.545190,18
0.460087,18
0.375655,18
0.291885,18
0.208763,18
0.126282,18
0.044430,18
0.963200,19
0.882580,19
0.802562,19
0.723138,19
0.644298,19
0.566034,19
0.488337,19
0.411200,19
0.334615,19
0.258572,19
0.183066,19
0.108088,19
0.033632,19
0.959688,20
0.886251,20
0.813315,20
0.740874,20
0.668915,20
0.597439,20
0.526437,20
0.455901,20
0.385826,20
0.316207,20
0.247038,20
0.178313,20
0.110026,20
0.042171,20
0.974743,21
0.907735,21
0.841145,21
0.774968,21
0.709195,21
0.643823,21
0.578849,21
0.514266,21
0.450071,21
0.386257,21
0.322821,21
0.259759,21
0.197066,21
0.134738,21
0.072769,21
0.011157,21
0.949896,22
0.888985,22
0.828418,22
0.768192,22
0.708300,22
0.648745,22
0.589517,22
0.530614,22
0.472034,22
0.413772,22
0.355825,22
0.298191,22
0.240864,22
0.183841,22
0.127123,22
0.070703,22
0.014576,22
0.958744,23
0.903202,23
0.847943,23
0.792969,23
0.738276,23
0.683862,23
0.629722,23
0.575853,23
0.522256,23
0.468924,23
0.415856,23
0.363050,23
0.310504,23
0.258214,23
0.206177,23
0.154392,23
0.102856,23
0.051566,23
0.000522,23
0.949720,24
0.899156,24
0.848829,24
0.798739,24
0.748884,24
0.699255,24
0.649859,24
0.600688,24
0.551743,24
0.503017,24
0.454515,24
0.406231,24
0.358162,24
0.310310,24
0.262670,24
0.215240,24
0.168019,24
0.121007,24
0.074199,24
0.027595,24
0.981193,25
0.934991,25
0.888986,25
0.843178,25
0.797568,25
0.752147,25
0.706920,25
0.661883,25
0.617036,25
0.572373,25
0.527897,25
0.483605,25
0.439497,25
0.395567,25
0.351818,25
0.308245,25
0.264849,25
0.221630,25
0.178584,25
0.135710,25
0.093006,25
0.050471,25
0.008105,25
0.965906,26
0.923873,26
0.882004,26
0.840297,26
0.798753,26
0.757369,26
0.716146,26
0.675077,26
0.634169,26
0.593414,26
0.552815,26
0.512366,26
0.472073,26
0.431929,26
0.391935,26
0.352090,26
0.312394,26
0.272844,26
0.233437,26
0.194177,26
0.155058,26
0.116084,26
0.077248,26
0.038555,26];

%figure 
%hold all;
% 
% for i=1:BLA_NUMCHANS
%     if i==1
%         fmin = 0;
%     else
%         fmin = fCentralMel(i-1);
%     end 
%     if i==BLA_NUMCHANS
%         fmax = fBordeMel;
%     else
%         fmax = fCentralMel(i+1);
%     end 
%        
%     vF = [];
%     
%     if i==1
%         fminSmp = 1;
%     else
%         fminSmp = fCentralFFT(i-1);
%     end 
%     if i==BLA_NUMCHANS
%         fmaxSmp = 255;
%     else
%         fmaxSmp = fCentralFFT(i+1);
%     end 
%     
%     amplitudesFiltros(i) = 0;
%     for j=fminSmp:fmaxSmp
% 
% %         if j<=fCentralFFT(i)
% %             valFiltro = (j-fmin)/(fCentralFFT(i)-fmin);
% %         else
% %             valFiltro = (fmax-j)/(fmax-fCentralFFT(i));
% %         end   
%         jmel = 1127*log(1+(j*8000/256)/700);
% 
%          if j<=fCentralFFT(i)
%              valFiltro = (jmel-fmin)/(fCentralMel(i)-fmin);
%          else
%              valFiltro = (fmax-jmel)/(fmax-fCentralMel(i));
%          end  
%         
%         vF = [vF valFiltro];
%         
%         amplitudesFiltros(i) = amplitudesFiltros(i) + valFiltro * bloqueFFTMagSquared(j);
%     end
%     
%     plot(fminSmp:fmaxSmp,vF);
%     
%     if amplitudesFiltros(i)<melFloor
%         amplitudesFiltros(i) = melFloor
%     end
% end 
amplitudesFiltros = zeros(1,BLA_NUMCHANS);

for j=1:256
    bin = filtros(j,2);
    t1 = filtros(j,1)*bloqueFFTMagSquared(j);
    
    if bin>0
        amplitudesFiltros(bin) = amplitudesFiltros(bin) + t1;
    end
    if bin<BLA_NUMCHANS && bin>-1
        amplitudesFiltros(bin+1) = amplitudesFiltros(bin+1) + bloqueFFTMagSquared(j)-t1;
    end
    
end

%for i=0:BLA_NUMCHANS
	%if amplitudesFiltros(i)<melFloor
		%amplitudesFiltros(i) = melFloor
	%end


amplitudLog = log(amplitudesFiltros);

e = [12.018131 12.046217 11.902216 11.092529 10.468547 11.343412 11.293248 11.397092 10.867512 11.930724 11.650800 11.693365 12.155772 12.517920 12.772550 13.419829 12.957275 14.004894 14.194377 15.437188 15.459925 15.034303 15.393250 15.892293 16.348156 16.512878];


%DCT
BLA_NUMCEPS = 12;
for i=1:BLA_NUMCEPS
    suma = 0;
    for j=1:BLA_NUMCHANS
        suma = suma + amplitudLog(j) * cos(pi.*i/BLA_NUMCHANS .* (j-0.5));
    end
    coefCepstrum(i) = sqrt(2/BLA_NUMCHANS) * suma;
end
coefCero = sqrt(2/BLA_NUMCHANS) * sum(amplitudLog);


%Liftering
BLA_CEPLIFTER = 22;
iNumCeps=1:BLA_NUMCEPS;
coefCepstrum(iNumCeps) = coefCepstrum(iNumCeps) .* (1.0+BLA_CEPLIFTER/2.0 .* sin(pi.*iNumCeps./BLA_CEPLIFTER));

f = [-21.84828568	12.94875336	2.22463274	4.24550867	3.28924537	3.31865692	-0.31340700	8.68779659	-4.08344650	1.82535815	1.28897691	-9.19121456	94.23547363];

coefs(NBLOQUE+1,:) = [coefCepstrum coefCero];

max(abs(coefs(NBLOQUE+1,:) - f))

figure
hold all;
plot(f,'r');
plot([coefCepstrum coefCero],'g')
%
%legend('Fijo 12 bits','N bits');

%end
%%

% delta1 = (coefs(2,:)-coefs(1,:)+2*coefs(3,:)-2*coefs(1,:))/10;
% delta2 = (coefs(3,:)-coefs(1,:)+2*coefs(4,:)-2*coefs(1,:))/10;
% delta3 = (coefs(4,:)-coefs(2,:)+2*coefs(5,:)-2*coefs(1,:))/10;
% delta4 = (coefs(5,:)-coefs(3,:)+2*coefs(6,:)-2*coefs(2,:))/10;

% deltabla1 = [-4.033591 -0.195916 2.443969 -4.419713 3.335290 -4.676653 -1.275682 5.421427 -1.978798 0.592845 2.696901 3.451294 1.954507];
% deltabla2 = [-5.754044 -0.050727 2.171057 -6.681327 2.764668 -4.501206 -2.504405 5.751759 -0.275700 -0.784820 0.808610 3.428675 3.334473];
% deltabla3 = [-5.864517 0.866994 2.205820 -5.784065 0.420424 -1.864677 -2.690715 2.925986 0.598025 -2.055844 -1.223422 1.053276 4.036443];
% deltabla4 = [-3.550306 1.177786 -0.198593 -2.717409 -1.197799 1.524451 -2.977823 -4.406374 0.500679 -4.376637 -3.326004 -1.801038 4.082896];

% deltadelta1 = (delta2-delta1+2*delta3-2*delta1)/10;
% deltadeltabla1 = [ -0.538230 0.227101 -0.074921 -0.499032 -0.640036 0.579940 -0.405879 -0.466055 0.685674 -0.667504 -0.972894 -0.481866 0.554384];
% figure
% hold all;
% plot(deltadelta1);
% plot(deltadeltabla1);
